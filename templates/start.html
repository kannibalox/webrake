{% extends "layout.html" %}
{% block content %}
  <div class="page_content">
    <h2>Start New</h2>
    <form id="argForm" action="{{ url_for('launch') }}" method="post">
    <table>
    <tr><td>Input:</td><td><input type="text" id="Input" name="Input"><button type="button" id="show_selector">Browse</button><div id="file_selector"></div></td></tr>
    <tr><td>Output:</td><td><input type="text" id="Output" name="Output"></td></tr>
    <tr><td>Title:</td><td><input type="text" id="Title" name="Title"></td><td>Main Feature: <input type="checkbox" id="mainFeature" name="mainFeature"/></tr></tr>
    <tr><td>x264 Opts.:</td><td><input type="text" id="x264opts" name="x264opts"></td></tr>
    <tr><td>Frame Rate:</td><td><select id="FrameRate" name="FrameRate">
          <option value="23.976">23.976</option>
          <option value="25">25</option>
          <option value="29.97">29.97</option>
          </select></td><tr>
    <tr><td>Resolution:</td><td>w:<input type="text" id="Width" name="Width" size="4"/> x h:<input type="text" id="Height" name="Hieght" size="4"/></td></tr>
    <tr><td>Anamorphic:</td><td><select id="Anamorphic" name="Anamorphic">
          <option value="Strict">Strict</option>
	  <option value="Custom">Custom</option>
	  <option value="Loose">Loose</option>
	  </select></td><tr>
    <tr><td>Keep Aspect Ratio</td><td><input type="checkbox" id="KeepAspectRatio" name="KeepAspectRatio"/></td></tr>
    <tr><td>x264 Presets:</td><td><select id="x264Preset" name="x264Preset">
	  {% for p in presets %}
	  <option value="{{ p }}">{{ p }}</option>
	  {% endfor %}
    </td></tr>
    <tr><td>Modulus:</td><td><input type="text" id="Modulus" name="Modulus" size="4"/></td></tr>
    <tr><td>Crop:</td><td></td></tr>
    <tr><td class="right">Top:</td><td><input type="text" size="3" id="CropTop" name="Crop"/></td></tr>
    <tr><td class="right">Bottom:</td><td><input type="text" size="3" id="CropBottom" name="Crop"/></td></tr>
    <tr><td class="right">Left:</td><td><input type="text" size="3" id="CropLeft" name="Crop"/></td></tr>
    <tr><td class="right">Right:</td><td><input type="text" size="3" id="CropRight" name="Crop"/></td></tr>
    <tr><td>Quality (CRF):</td><td><input type="text" id="Quality" name="Quality"></td></tr>
    <tr><td>Audio Channels:</td><td><input type="text" id="AudioUse" name="AudioUse"></td></tr>
    <tr><td>Audio Transfer Method:</td><td><input type="Text" id="AudioEncoder" name="AudioEncoder"/></td></tr>
    <tr><td>Preview (short duration):</td><td><input type="checkbox" id="isPreview" name="isPreview"></td></tr>
    <tr><td>Include chapters:</td><td><input type="checkbox" id="IncludeChapters" name="IncludeChapters"></td></tr>
    <tr><td>Deinterlace:</td><td><input type="checkbox" id="Deinterlace" name="Deinterlace"></td></tr>
    <tr><td>Detelecine:</td><td><input type="checkbox" id="Detelecine" name="Detelecine"></td></tr>
    <tr><td>Start Duration:</td><td><input type="text" id="StartDuration" name="Duration"></td></tr>
    <tr><td>End Duration:</td><td><input type="text" id="EndDuration" name="Duration"></td></tr>
    <tr><td>Other Parameters:</td><td><input type="text" id="AddtlOpts" name="AddtlOpts"></td></tr>
    </table>
    <input type="submit" value="Start Encode" />
    </form>
  </div>
{% endblock %}
{% block script %}
<script src="static/js/jqueryFileTree.js"></script>
<script type="text/javascript">
var copyJobID = {{ copyJob }};
$.getJSON('{{ url_for('jobJSON', jobID=copyJob) }}', function(data) {
  $.each(data['args'], function(arg, val) {
    elem = $('#' + arg);
    if (elem.is(':checkbox')) {
      elem.attr('checked', arg);
    } else {
      elem.val(val);
    }
  });
  if ('Title' in data['args']) {
    if (data['args']['Title'] == "--main-feature") {
      $('#mainFeature').attr('checked', true);
    }
  }
  if ('Duration' in data['args']) {
    $('#StartDuration').val(data['args']['Duration'][0]);
    $('#EndDuration').val(data['args']['Duration'][1]);
  }
  if ('Crop' in data['args']) {
    $('#CropTop').val(data['args']['Crop'][0]);
    $('#CropBottom').val(data['args']['Crop'][1]);
    $('#CropLeft').val(data['args']['Crop'][2]);
    $('#CropRight').val(data['args']['Crop'][3]);
  }
  $('#mainFeature').change(function () {
    if($(this).is(":checked")) {
       $('#Title').attr("disabled", "disabled");
       $('#Title').val('--main-feature');
    } else {
       $('#Title').removeAttr("disabled");
       $('#Title').val('');
    }
  });
  $('#file_selector').hide();
  $('#show_selector').click(function() { 
    $('#file_selector').toggle();
    if ($(this).text() == "Browse") {
      $(this).text("Done");
    } else {
      $(this).text("Browse");
    }
  });
  $('#file_selector').fileTree({ 
    root: '{{ selectorRoot }}', 
    script: '{{ url_for('dirlist') }}',
    expandSpeed: -1, 
    collapseSpeed: -1},
    function(file) {
      $('#Input').val(file);
  });
});
</script>
{% endblock %}
